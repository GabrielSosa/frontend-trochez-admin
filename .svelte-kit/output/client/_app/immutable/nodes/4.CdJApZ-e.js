import{S as se,i as ne,s as ie,d as p,p as re,q as R,r as G,N as ce,b as C,v as ae,c as h,w as m,e as y,f as w,x as le,h as P,g as z,j as E,z as oe,k as V,t as x,l as ue,A as fe,n as B,y as J,a as F,m as de,o as me,u as _e,D as pe,B as he,C as K,G as Q,E as H,F as M,O as ge}from"../chunks/DH0NG5GU.js";import{N as ve,e as W}from"../chunks/DgJbwxg5.js";import"../chunks/IHki7fMi.js";import{g as L}from"../chunks/CT3oog3n.js";import{p as be}from"../chunks/BiE1Y5NG.js";import{g as ke,A as we,v as ye,c as Ee}from"../chunks/9ty-vnRU.js";import{a as X,A as q}from"../chunks/bK7qKMo_.js";function Se({params:s}){return{id:s.id}}const Be=Object.freeze(Object.defineProperty({__proto__:null,load:Se},Symbol.toStringTag,{value:"Module"}));function Y(s,t,e){const r=s.slice();return r[18]=t[e][0],r[19]=t[e][1],r}function Ae(s){let t,e,r,a,l=s[3]&&Z(s);function o(n){s[16](n)}let d={validationErrors:s[5],isSubmitting:s[2],isEdit:!0};return s[9]!==void 0&&(d.formData=s[9]),e=new we({props:d}),de.push(()=>me(e,"formData",o)),e.$on("submit",s[11]),e.$on("cancel",s[12]),{c(){l&&l.c(),t=V(),oe(e.$$.fragment)},l(n){l&&l.l(n),t=P(n),le(e.$$.fragment,n)},m(n,i){l&&l.m(n,i),C(n,t,i),ae(e,n,i),a=!0},p(n,i){n[3]?l?l.p(n,i):(l=Z(n),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null);const c={};i&32&&(c.validationErrors=n[5]),i&4&&(c.isSubmitting=n[2]),!r&&i&512&&(r=!0,c.formData=n[9],_e(()=>r=!1)),e.$set(c)},i(n){a||(G(e.$$.fragment,n),a=!0)},o(n){R(e.$$.fragment,n),a=!1},d(n){n&&p(t),l&&l.d(n),re(e,n)}}}function De(s){let t,e,r="Error:",a,l,o,d=Object.keys(s[5]).length>0?" Corrige los siguientes campos:":"",n,i,c=Object.keys(s[5]).length>0,f=c&&$(s);return{c(){t=E("div"),e=E("span"),e.textContent=r,a=V(),l=E("span"),o=x(s[4]),n=x(d),i=V(),f&&f.c(),this.h()},l(v){t=y(v,"DIV",{class:!0,role:!0});var b=w(t);e=y(b,"SPAN",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-1nq00is"&&(e.textContent=r),a=P(b),l=y(b,"SPAN",{class:!0});var g=w(l);o=z(g,s[4]),n=z(g,d),g.forEach(p),i=P(b),f&&f.l(b),b.forEach(p),this.h()},h(){m(e,"class","block sm:inline font-medium"),m(l,"class","block sm:inline"),m(t,"class","bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6"),m(t,"role","alert")},m(v,b){C(v,t,b),h(t,e),h(t,a),h(t,l),h(l,o),h(l,n),h(t,i),f&&f.m(t,null)},p(v,b){b&16&&F(o,v[4]),b&32&&d!==(d=Object.keys(v[5]).length>0?" Corrige los siguientes campos:":"")&&F(n,d),b&32&&(c=Object.keys(v[5]).length>0),c?f?f.p(v,b):(f=$(v),f.c(),f.m(t,null)):f&&(f.d(1),f=null)},i:B,o:B,d(v){v&&p(t),f&&f.d()}}}function je(s){let t,e='<p class="text-gray-500">Cargando datos del avalúo...</p>';return{c(){t=E("div"),t.innerHTML=e,this.h()},l(r){t=y(r,"DIV",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-gztuae"&&(t.innerHTML=e),this.h()},h(){m(t,"class","text-center py-10")},m(r,a){C(r,t,a)},p:B,i:B,o:B,d(r){r&&p(t)}}}function Z(s){let t,e,r,a,l,o,d,n,i,c="Volver a Lista",f,v;function b(_,k){return _[7]&&_[8]===_[6]?Ce:Ie}let g=b(s),A=g(s);return{c(){t=E("div"),e=E("div"),r=E("span"),a=x(s[3]),l=V(),o=E("div"),d=E("button"),A.c(),n=V(),i=E("button"),i.textContent=c,this.h()},l(_){t=y(_,"DIV",{class:!0,role:!0});var k=w(t);e=y(k,"DIV",{class:!0});var D=w(e);r=y(D,"SPAN",{class:!0});var O=w(r);a=z(O,s[3]),O.forEach(p),l=P(D),o=y(D,"DIV",{class:!0});var T=w(o);d=y(T,"BUTTON",{class:!0});var S=w(d);A.l(S),S.forEach(p),n=P(T),i=y(T,"BUTTON",{class:!0,"data-svelte-h":!0}),J(i)!=="svelte-17u9px8"&&(i.textContent=c),T.forEach(p),D.forEach(p),k.forEach(p),this.h()},h(){m(r,"class","block sm:inline"),d.disabled=s[7],m(d,"class","bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-3 py-1 rounded text-sm font-medium transition-colors flex items-center"),m(i,"class","bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm font-medium transition-colors"),m(o,"class","flex gap-2"),m(e,"class","flex justify-between items-center"),m(t,"class","bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-6"),m(t,"role","alert")},m(_,k){C(_,t,k),h(t,e),h(e,r),h(r,a),h(e,l),h(e,o),h(o,d),A.m(d,null),h(o,n),h(o,i),f||(v=[K(d,"click",s[14]),K(i,"click",s[15])],f=!0)},p(_,k){k&8&&F(a,_[3]),g!==(g=b(_))&&(A.d(1),A=g(_),A&&(A.c(),A.m(d,null))),k&128&&(d.disabled=_[7])},d(_){_&&p(t),A.d(),f=!1,he(v)}}}function Ie(s){let t,e,r;return{c(){t=M("svg"),e=M("path"),r=x(`
                  Imprimir Certificado`),this.h()},l(a){t=H(a,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var l=w(t);e=H(l,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),w(e).forEach(p),l.forEach(p),r=z(a,`
                  Imprimir Certificado`),this.h()},h(){m(e,"fill-rule","evenodd"),m(e,"d","M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z"),m(e,"clip-rule","evenodd"),m(t,"xmlns","http://www.w3.org/2000/svg"),m(t,"class","h-4 w-4 mr-1"),m(t,"viewBox","0 0 20 20"),m(t,"fill","currentColor")},m(a,l){C(a,t,l),h(t,e),C(a,r,l)},d(a){a&&(p(t),p(r))}}}function Ce(s){let t,e,r,a;return{c(){t=M("svg"),e=M("circle"),r=M("path"),a=x(`
                  Generando...`),this.h()},l(l){t=H(l,"svg",{class:!0,xmlns:!0,fill:!0,viewBox:!0});var o=w(t);e=H(o,"circle",{class:!0,cx:!0,cy:!0,r:!0,stroke:!0,"stroke-width":!0}),w(e).forEach(p),r=H(o,"path",{class:!0,fill:!0,d:!0}),w(r).forEach(p),o.forEach(p),a=z(l,`
                  Generando...`),this.h()},h(){m(e,"class","opacity-25"),m(e,"cx","12"),m(e,"cy","12"),m(e,"r","10"),m(e,"stroke","currentColor"),m(e,"stroke-width","4"),m(r,"class","opacity-75"),m(r,"fill","currentColor"),m(r,"d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),m(t,"class","animate-spin -ml-1 mr-2 h-4 w-4 text-white"),m(t,"xmlns","http://www.w3.org/2000/svg"),m(t,"fill","none"),m(t,"viewBox","0 0 24 24")},m(l,o){C(l,t,o),h(t,e),h(t,r),C(l,a,o)},d(l){l&&(p(t),p(a))}}}function $(s){let t,e=W(Object.entries(s[5])),r=[];for(let a=0;a<e.length;a+=1)r[a]=te(Y(s,e,a));return{c(){t=E("ul");for(let a=0;a<r.length;a+=1)r[a].c();this.h()},l(a){t=y(a,"UL",{class:!0});var l=w(t);for(let o=0;o<r.length;o+=1)r[o].l(l);l.forEach(p),this.h()},h(){m(t,"class","mt-2 list-disc list-inside")},m(a,l){C(a,t,l);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(t,null)},p(a,l){if(l&32){e=W(Object.entries(a[5]));let o;for(o=0;o<e.length;o+=1){const d=Y(a,e,o);r[o]?r[o].p(d,l):(r[o]=te(d),r[o].c(),r[o].m(t,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=e.length}},d(a){a&&p(t),pe(r,a)}}}function ee(s){let t,e,r=s[18]+"",a,l,o,d=s[19]+"",n;return{c(){t=E("li"),e=E("strong"),a=x(r),l=x(":"),o=V(),n=x(d)},l(i){t=y(i,"LI",{});var c=w(t);e=y(c,"STRONG",{});var f=w(e);a=z(f,r),l=z(f,":"),f.forEach(p),o=P(c),n=z(c,d),c.forEach(p)},m(i,c){C(i,t,c),h(t,e),h(e,a),h(e,l),h(t,o),h(t,n)},p(i,c){c&32&&r!==(r=i[18]+"")&&F(a,r),c&32&&d!==(d=i[19]+"")&&F(n,d)},d(i){i&&p(t)}}}function te(s){let t,e=s[19]&&ee(s);return{c(){e&&e.c(),t=Q()},l(r){e&&e.l(r),t=Q()},m(r,a){e&&e.m(r,a),C(r,t,a)},p(r,a){r[19]?e?e.p(r,a):(e=ee(r),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},d(r){r&&p(t),e&&e.d(r)}}}function Oe(s){let t,e,r,a,l,o,d,n,i,c,f,v;e=new ve({props:{user:s[0]}});const b=[je,De,Ae],g=[];function A(_,k){return _[1]?0:_[4]?1:2}return c=A(s),f=g[c]=b[c](s),{c(){t=E("div"),oe(e.$$.fragment),r=V(),a=E("main"),l=E("div"),o=E("h1"),d=x("Editar Avalúo #"),n=x(s[10]),i=V(),f.c(),this.h()},l(_){t=y(_,"DIV",{class:!0});var k=w(t);le(e.$$.fragment,k),r=P(k),a=y(k,"MAIN",{class:!0});var D=w(a);l=y(D,"DIV",{class:!0});var O=w(l);o=y(O,"H1",{class:!0});var T=w(o);d=z(T,"Editar Avalúo #"),n=z(T,s[10]),T.forEach(p),O.forEach(p),i=P(D),f.l(D),D.forEach(p),k.forEach(p),this.h()},h(){m(o,"class","text-2xl font-bold text-gray-800"),m(l,"class","flex justify-between items-center mb-6"),m(a,"class","max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"),m(t,"class","min-h-screen bg-gray-50")},m(_,k){C(_,t,k),ae(e,t,null),h(t,r),h(t,a),h(a,l),h(l,o),h(o,d),h(o,n),h(a,i),g[c].m(a,null),v=!0},p(_,[k]){const D={};k&1&&(D.user=_[0]),e.$set(D);let O=c;c=A(_),c===O?g[c].p(_,k):(ge(),R(g[O],1,1,()=>{g[O]=null}),ce(),f=g[c],f?f.p(_,k):(f=g[c]=b[c](_),f.c()),G(f,1),f.m(a,null))},i(_){v||(G(e.$$.fragment,_),G(f),v=!0)},o(_){R(e.$$.fragment,_),R(f),v=!1},d(_){_&&p(t),re(e),g[c].d()}}}function Te(s,t,e){let r;ue(s,be,S=>e(17,r=S));let a=r.params.id,l=null,o=!0,d=!1,n="",i="",c={},f=null,v=!1,b=null,g=ke();fe(async()=>{var j;const S=localStorage.getItem("userData");if(S&&e(0,l=JSON.parse(S)),!localStorage.getItem("jwtToken")){e(4,i="Sesión no válida. Redirigiendo al login..."),setTimeout(()=>L("/login"),2e3);return}try{e(1,o=!0);const u=await X(q.AVALUOS.getById(a));console.log("Datos del avalúo cargados:",u),e(9,g={appraisal_number:u.id||u.appraisal_number||a,appraisal_date:((j=u.appraisal_date)==null?void 0:j.split("T")[0])||"",vehicle_description:u.vehicle_description||"",brand:u.brand||"",model_year:u.model_year||0,color:u.color||"",mileage:u.mileage||0,fuel_type:u.fuel_type||"GAS",engine_size:u.engine_size||0,plate_number:u.plate_number||"",applicant:u.applicant||"",owner:u.owner||"",appraisal_value_usd:u.appraisal_value_usd||0,appraisal_value_trochez:u.appraisal_value_trochez||0,apprasail_value_bank:u.apprasail_value_bank||0,vin:u.vin||"",vin_card:u.vin_card||"",engine_number:u.engine_number||"",engine_number_card:u.engine_number_card||"",notes:u.notes||"",extras:u.extras||"",validity_days:u.validity_days||30,validity_kms:u.validity_kms||1e3,cert:u.cert||"",deductions:u.deductions||[]})}catch(u){console.error("Error al cargar el avalúo:",u),e(4,i=`Error al cargar el avalúo: ${u.message||"Error desconocido"}`),u.status===401?(localStorage.removeItem("jwtToken"),setTimeout(()=>L("/login"),2e3),e(4,i="Sesión expirada. Por favor inicie sesión nuevamente.")):u.status===404&&(e(4,i=`No se encontró el avalúo con ID ${a}.`),setTimeout(()=>L("/avaluos"),3e3))}finally{e(1,o=!1)}});async function A(){var S;e(2,d=!0),e(4,i=""),e(3,n=""),e(5,c={});try{if(e(5,c=ye(g,!0)),console.log("Errores de validación en edición:",c),Object.keys(c).length>0&&(e(5,c=Object.fromEntries(Object.entries(c).filter(([u,I])=>I))),Object.keys(c).length>0))throw new Error("Por favor corrija los errores de validación.");if(!localStorage.getItem("jwtToken"))throw new Error("No se encontró token de autenticación. Por favor inicie sesión nuevamente.");const j=Ee(g);console.log("Datos enviados al API (Actualización):",JSON.stringify(j,null,2));try{await X(q.AVALUOS.update(a),{method:"PUT",body:JSON.stringify(j)}),e(6,f=a),e(3,n="Avalúo actualizado correctamente."),e(2,d=!1)}catch(u){console.error("API Error:",u),u.status===401?(localStorage.removeItem("jwtToken"),setTimeout(()=>L("/login"),2e3),e(4,i="Sesión expirada. Por favor inicie sesión nuevamente.")):u.status===422&&((S=u.data)!=null&&S.detail)?(e(4,i="Error de validación del servidor. Por favor revise los campos."),e(5,c={}),u.data.detail.forEach(I=>{const U=I.loc[I.loc.length-1];U&&e(5,c[U]=I.msg,c)})):e(4,i=u.message||"Error al comunicarse con el servidor.")}}catch(N){console.error("Error submitting form:",N),i||e(4,i=N.message||"Ha ocurrido un error al actualizar el avalúo.")}finally{e(2,d=!1)}}function _(){L("/avaluos")}async function k(S){try{const N=localStorage.getItem("jwtToken");if(!N){alert("No se encontró token de autenticación. Por favor inicie sesión nuevamente."),setTimeout(()=>L("/login"),1e3);return}e(7,v=!0),e(8,b=S);const j=await fetch(q.CERTIFICADOS.get(S),{method:"GET",headers:{Authorization:`Bearer ${N}`}});if(!j.ok)throw new Error(`Error al obtener el certificado: ${j.status} ${j.statusText}`);const u=j.headers.get("content-type");if(u&&u.includes("application/pdf")){const I=await j.blob(),U=window.URL.createObjectURL(I);window.open(U,"_blank")}else if(u&&u.includes("application/json")){const I=await j.json();if(I.url)window.open(I.url,"_blank");else throw new Error(I.message||"Error al generar el certificado")}else{const I=await j.blob(),U=window.URL.createObjectURL(I);window.open(U,"_blank")}}catch(N){console.error("Error al obtener el certificado:",N),alert(`Error al obtener el certificado: ${N.message}`)}finally{e(7,v=!1),e(8,b=null)}}const D=()=>k(f),O=()=>L("/avaluos");function T(S){g=S,e(9,g)}return[l,o,d,n,i,c,f,v,b,g,a,A,_,k,D,O,T]}class He extends se{constructor(t){super(),ne(this,t,Te,Oe,ie,{})}}export{He as component,Be as universal};
