import{S as se,i as ne,s as ie,d as p,p as re,q as F,r as R,N as ce,b as T,v as ae,c as h,w as d,e as k,f as b,x as le,h as V,g as z,j as w,z as oe,k as x,t as P,l as ue,A as fe,n as B,y as J,a as G,m as de,o as me,u as _e,D as pe,B as he,C as K,G as Q,E as H,F as M,O as ge}from"../chunks/DH0NG5GU.js";import{N as ve,e as W}from"../chunks/CPX_CQGk.js";import"../chunks/IHki7fMi.js";import{g as L}from"../chunks/B9hiGY2_.js";import{p as be}from"../chunks/DsLxeXaI.js";import{g as ke,A as we,v as ye,c as Ee}from"../chunks/BB6QSv2G.js";import{a as X,A as q}from"../chunks/bK7qKMo_.js";function Se({params:i}){return{id:i.id}}const Be=Object.freeze(Object.defineProperty({__proto__:null,load:Se},Symbol.toStringTag,{value:"Module"}));function Y(i,t,e){const r=i.slice();return r[18]=t[e][0],r[19]=t[e][1],r}function Ae(i){let t,e,r,a,l=i[3]&&Z(i);function o(c){i[16](c)}let _={validationErrors:i[5],isSubmitting:i[2]};return i[9]!==void 0&&(_.formData=i[9]),e=new we({props:_}),de.push(()=>me(e,"formData",o)),e.$on("submit",i[11]),e.$on("cancel",i[12]),{c(){l&&l.c(),t=x(),oe(e.$$.fragment)},l(c){l&&l.l(c),t=V(c),le(e.$$.fragment,c)},m(c,s){l&&l.m(c,s),T(c,t,s),ae(e,c,s),a=!0},p(c,s){c[3]?l?l.p(c,s):(l=Z(c),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null);const n={};s&32&&(n.validationErrors=c[5]),s&4&&(n.isSubmitting=c[2]),!r&&s&512&&(r=!0,n.formData=c[9],_e(()=>r=!1)),e.$set(n)},i(c){a||(R(e.$$.fragment,c),a=!0)},o(c){F(e.$$.fragment,c),a=!1},d(c){c&&p(t),l&&l.d(c),re(e,c)}}}function De(i){let t,e,r="Error:",a,l,o,_,c=Object.keys(i[5]).length>0&&!i[4].includes("validación"),s=c&&$(i);return{c(){t=w("div"),e=w("span"),e.textContent=r,a=x(),l=w("span"),o=P(i[4]),_=x(),s&&s.c(),this.h()},l(n){t=k(n,"DIV",{class:!0,role:!0});var f=b(t);e=k(f,"SPAN",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-1nq00is"&&(e.textContent=r),a=V(f),l=k(f,"SPAN",{class:!0});var E=b(l);o=z(E,i[4]),E.forEach(p),_=V(f),s&&s.l(f),f.forEach(p),this.h()},h(){d(e,"class","block sm:inline font-medium"),d(l,"class","block sm:inline"),d(t,"class","bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6"),d(t,"role","alert")},m(n,f){T(n,t,f),h(t,e),h(t,a),h(t,l),h(l,o),h(t,_),s&&s.m(t,null)},p(n,f){f&16&&G(o,n[4]),f&48&&(c=Object.keys(n[5]).length>0&&!n[4].includes("validación")),c?s?s.p(n,f):(s=$(n),s.c(),s.m(t,null)):s&&(s.d(1),s=null)},i:B,o:B,d(n){n&&p(t),s&&s.d()}}}function Ie(i){let t,e='<p class="text-gray-500">Cargando datos del avalúo...</p>';return{c(){t=w("div"),t.innerHTML=e,this.h()},l(r){t=k(r,"DIV",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-gztuae"&&(t.innerHTML=e),this.h()},h(){d(t,"class","text-center py-10")},m(r,a){T(r,t,a)},p:B,i:B,o:B,d(r){r&&p(t)}}}function Z(i){let t,e,r,a,l,o,_,c,s,n="Volver a Lista",f,E;function N(m,g){return m[7]&&m[8]===m[6]?je:Te}let v=N(i),S=v(i);return{c(){t=w("div"),e=w("div"),r=w("span"),a=P(i[3]),l=x(),o=w("div"),_=w("button"),S.c(),c=x(),s=w("button"),s.textContent=n,this.h()},l(m){t=k(m,"DIV",{class:!0,role:!0});var g=b(t);e=k(g,"DIV",{class:!0});var A=b(e);r=k(A,"SPAN",{class:!0});var j=b(r);a=z(j,i[3]),j.forEach(p),l=V(A),o=k(A,"DIV",{class:!0});var C=b(o);_=k(C,"BUTTON",{class:!0});var y=b(_);S.l(y),y.forEach(p),c=V(C),s=k(C,"BUTTON",{class:!0,"data-svelte-h":!0}),J(s)!=="svelte-17u9px8"&&(s.textContent=n),C.forEach(p),A.forEach(p),g.forEach(p),this.h()},h(){d(r,"class","block sm:inline"),_.disabled=i[7],d(_,"class","bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-3 py-1 rounded text-sm font-medium transition-colors flex items-center"),d(s,"class","bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm font-medium transition-colors"),d(o,"class","flex gap-2"),d(e,"class","flex justify-between items-center"),d(t,"class","bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-6"),d(t,"role","alert")},m(m,g){T(m,t,g),h(t,e),h(e,r),h(r,a),h(e,l),h(e,o),h(o,_),S.m(_,null),h(o,c),h(o,s),f||(E=[K(_,"click",i[14]),K(s,"click",i[15])],f=!0)},p(m,g){g&8&&G(a,m[3]),v!==(v=N(m))&&(S.d(1),S=v(m),S&&(S.c(),S.m(_,null))),g&128&&(_.disabled=m[7])},d(m){m&&p(t),S.d(),f=!1,he(E)}}}function Te(i){let t,e,r;return{c(){t=M("svg"),e=M("path"),r=P(`
                  Imprimir Certificado`),this.h()},l(a){t=H(a,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var l=b(t);e=H(l,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),b(e).forEach(p),l.forEach(p),r=z(a,`
                  Imprimir Certificado`),this.h()},h(){d(e,"fill-rule","evenodd"),d(e,"d","M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z"),d(e,"clip-rule","evenodd"),d(t,"xmlns","http://www.w3.org/2000/svg"),d(t,"class","h-4 w-4 mr-1"),d(t,"viewBox","0 0 20 20"),d(t,"fill","currentColor")},m(a,l){T(a,t,l),h(t,e),T(a,r,l)},d(a){a&&(p(t),p(r))}}}function je(i){let t,e,r,a;return{c(){t=M("svg"),e=M("circle"),r=M("path"),a=P(`
                  Generando...`),this.h()},l(l){t=H(l,"svg",{class:!0,xmlns:!0,fill:!0,viewBox:!0});var o=b(t);e=H(o,"circle",{class:!0,cx:!0,cy:!0,r:!0,stroke:!0,"stroke-width":!0}),b(e).forEach(p),r=H(o,"path",{class:!0,fill:!0,d:!0}),b(r).forEach(p),o.forEach(p),a=z(l,`
                  Generando...`),this.h()},h(){d(e,"class","opacity-25"),d(e,"cx","12"),d(e,"cy","12"),d(e,"r","10"),d(e,"stroke","currentColor"),d(e,"stroke-width","4"),d(r,"class","opacity-75"),d(r,"fill","currentColor"),d(r,"d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),d(t,"class","animate-spin -ml-1 mr-2 h-4 w-4 text-white"),d(t,"xmlns","http://www.w3.org/2000/svg"),d(t,"fill","none"),d(t,"viewBox","0 0 24 24")},m(l,o){T(l,t,o),h(t,e),h(t,r),T(l,a,o)},d(l){l&&(p(t),p(a))}}}function $(i){let t,e=W(Object.entries(i[5])),r=[];for(let a=0;a<e.length;a+=1)r[a]=te(Y(i,e,a));return{c(){t=w("ul");for(let a=0;a<r.length;a+=1)r[a].c();this.h()},l(a){t=k(a,"UL",{class:!0});var l=b(t);for(let o=0;o<r.length;o+=1)r[o].l(l);l.forEach(p),this.h()},h(){d(t,"class","mt-2 list-disc list-inside")},m(a,l){T(a,t,l);for(let o=0;o<r.length;o+=1)r[o]&&r[o].m(t,null)},p(a,l){if(l&32){e=W(Object.entries(a[5]));let o;for(o=0;o<e.length;o+=1){const _=Y(a,e,o);r[o]?r[o].p(_,l):(r[o]=te(_),r[o].c(),r[o].m(t,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=e.length}},d(a){a&&p(t),pe(r,a)}}}function ee(i){let t,e,r=i[18]+"",a,l,o,_=i[19]+"",c;return{c(){t=w("li"),e=w("strong"),a=P(r),l=P(":"),o=x(),c=P(_)},l(s){t=k(s,"LI",{});var n=b(t);e=k(n,"STRONG",{});var f=b(e);a=z(f,r),l=z(f,":"),f.forEach(p),o=V(n),c=z(n,_),n.forEach(p)},m(s,n){T(s,t,n),h(t,e),h(e,a),h(e,l),h(t,o),h(t,c)},p(s,n){n&32&&r!==(r=s[18]+"")&&G(a,r),n&32&&_!==(_=s[19]+"")&&G(c,_)},d(s){s&&p(t)}}}function te(i){let t,e=i[19]&&ee(i);return{c(){e&&e.c(),t=Q()},l(r){e&&e.l(r),t=Q()},m(r,a){e&&e.m(r,a),T(r,t,a)},p(r,a){r[19]?e?e.p(r,a):(e=ee(r),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},d(r){r&&p(t),e&&e.d(r)}}}function Ce(i){let t,e,r,a,l,o,_,c,s,n,f,E;e=new ve({props:{user:i[0]}});const N=[Ie,De,Ae],v=[];function S(m,g){return m[1]?0:m[4]&&!m[1]?1:2}return n=S(i),f=v[n]=N[n](i),{c(){t=w("div"),oe(e.$$.fragment),r=x(),a=w("main"),l=w("div"),o=w("h1"),_=P("Editar Avalúo #"),c=P(i[10]),s=x(),f.c(),this.h()},l(m){t=k(m,"DIV",{class:!0});var g=b(t);le(e.$$.fragment,g),r=V(g),a=k(g,"MAIN",{class:!0});var A=b(a);l=k(A,"DIV",{class:!0});var j=b(l);o=k(j,"H1",{class:!0});var C=b(o);_=z(C,"Editar Avalúo #"),c=z(C,i[10]),C.forEach(p),j.forEach(p),s=V(A),f.l(A),A.forEach(p),g.forEach(p),this.h()},h(){d(o,"class","text-2xl font-bold text-gray-800"),d(l,"class","flex justify-between items-center mb-6"),d(a,"class","max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"),d(t,"class","min-h-screen bg-gray-50")},m(m,g){T(m,t,g),ae(e,t,null),h(t,r),h(t,a),h(a,l),h(l,o),h(o,_),h(o,c),h(a,s),v[n].m(a,null),E=!0},p(m,[g]){const A={};g&1&&(A.user=m[0]),e.$set(A);let j=n;n=S(m),n===j?v[n].p(m,g):(ge(),F(v[j],1,1,()=>{v[j]=null}),ce(),f=v[n],f?f.p(m,g):(f=v[n]=N[n](m),f.c()),R(f,1),f.m(a,null))},i(m){E||(R(e.$$.fragment,m),R(f),E=!0)},o(m){F(e.$$.fragment,m),F(f),E=!1},d(m){m&&p(t),re(e),v[n].d()}}}function Oe(i,t,e){let r;ue(i,be,y=>e(17,r=y));let a=r.params.id,l=null,o=!0,_=!1,c="",s="",n={},f=null,E=!1,N=null,v=ke();fe(async()=>{var D;const y=localStorage.getItem("userData");if(y&&e(0,l=JSON.parse(y)),!localStorage.getItem("jwtToken")){e(4,s="Sesión no válida. Redirigiendo al login..."),setTimeout(()=>L("/login"),2e3);return}try{e(1,o=!0);const u=await X(q.AVALUOS.getById(a));console.log("Datos del avalúo cargados:",u),e(9,v={appraisal_number:u.id||u.appraisal_number||a,appraisal_date:((D=u.appraisal_date)==null?void 0:D.split("T")[0])||"",vehicle_description:u.vehicle_description||"",brand:u.brand||"",model_year:u.model_year||0,color:u.color||"",mileage:u.mileage||0,fuel_type:u.fuel_type||"GAS",engine_size:u.engine_size||0,plate_number:u.plate_number||"",applicant:u.applicant||"",owner:u.owner||"",appraisal_value_usd:u.appraisal_value_usd||0,appraisal_value_trochez:u.appraisal_value_trochez||0,apprasail_value_bank:u.apprasail_value_bank||0,vin:u.vin||"",vin_card:u.vin_card||"",engine_number:u.engine_number||"",engine_number_card:u.engine_number_card||"",notes:u.notes||"",extras:u.extras||"",validity_days:u.validity_days||30,validity_kms:u.validity_kms||1e3,cert:u.cert||"",deductions:u.deductions||[]})}catch(u){console.error("Error al cargar el avalúo:",u),e(4,s=`Error al cargar el avalúo: ${u.message||"Error desconocido"}`),u.status===401?(localStorage.removeItem("jwtToken"),setTimeout(()=>L("/login"),2e3),e(4,s="Sesión expirada. Por favor inicie sesión nuevamente.")):u.status===404&&(e(4,s=`No se encontró el avalúo con ID ${a}.`),setTimeout(()=>L("/avaluos"),3e3))}finally{e(1,o=!1)}});async function S(){var y;e(2,_=!0),e(4,s=""),e(3,c=""),e(5,n={});try{if(e(5,n=ye(v)),Object.keys(n).length>0&&(e(5,n=Object.fromEntries(Object.entries(n).filter(([u,I])=>I))),Object.keys(n).length>0))throw new Error("Por favor corrija los errores de validación.");if(!localStorage.getItem("jwtToken"))throw new Error("No se encontró token de autenticación. Por favor inicie sesión nuevamente.");const D=Ee(v);console.log("Datos enviados al API (Actualización):",JSON.stringify(D,null,2));try{await X(q.AVALUOS.update(a),{method:"PUT",body:JSON.stringify(D)}),e(6,f=a),e(3,c="Avalúo actualizado correctamente."),e(2,_=!1)}catch(u){console.error("API Error:",u),u.status===401?(localStorage.removeItem("jwtToken"),setTimeout(()=>L("/login"),2e3),e(4,s="Sesión expirada. Por favor inicie sesión nuevamente.")):u.status===422&&((y=u.data)!=null&&y.detail)?(e(4,s="Error de validación del servidor. Por favor revise los campos."),e(5,n={}),u.data.detail.forEach(I=>{const U=I.loc[I.loc.length-1];U&&e(5,n[U]=I.msg,n)})):e(4,s=u.message||"Error al comunicarse con el servidor.")}}catch(O){console.error("Error submitting form:",O),s||e(4,s=O.message||"Ha ocurrido un error al actualizar el avalúo.")}finally{e(2,_=!1)}}function m(){L("/avaluos")}async function g(y){try{const O=localStorage.getItem("jwtToken");if(!O){alert("No se encontró token de autenticación. Por favor inicie sesión nuevamente."),setTimeout(()=>L("/login"),1e3);return}e(7,E=!0),e(8,N=y);const D=await fetch(q.CERTIFICADOS.get(y),{method:"GET",headers:{Authorization:`Bearer ${O}`}});if(!D.ok)throw new Error(`Error al obtener el certificado: ${D.status} ${D.statusText}`);const u=D.headers.get("content-type");if(u&&u.includes("application/pdf")){const I=await D.blob(),U=window.URL.createObjectURL(I);window.open(U,"_blank")}else if(u&&u.includes("application/json")){const I=await D.json();if(I.url)window.open(I.url,"_blank");else throw new Error(I.message||"Error al generar el certificado")}else{const I=await D.blob(),U=window.URL.createObjectURL(I);window.open(U,"_blank")}}catch(O){console.error("Error al obtener el certificado:",O),alert(`Error al obtener el certificado: ${O.message}`)}finally{e(7,E=!1),e(8,N=null)}}const A=()=>g(f),j=()=>L("/avaluos");function C(y){v=y,e(9,v)}return[l,o,_,c,s,n,f,E,N,v,a,S,m,g,A,j,C]}class He extends se{constructor(t){super(),ne(this,t,Oe,Ce,ie,{})}}export{He as component,Be as universal};
