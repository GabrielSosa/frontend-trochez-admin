import{S as ie,i as ce,s as ue,d as _,p as oe,q,r as W,Q as fe,b as I,v as le,c as h,w as m,e as C,f as E,x as ne,h as U,g as x,j as S,z as se,k as B,t as V,l as de,A as me,n as M,y as Q,a as G,m as pe,o as _e,u as he,D as ge,B as be,C as K,G as X,E as R,F,R as ve}from"../chunks/CnbjcvQe.js";import{N as ke,e as Y}from"../chunks/Dp1kotmo.js";import"../chunks/IHki7fMi.js";import{g as H}from"../chunks/CZYdmkq_.js";import{p as we}from"../chunks/DiJChxwk.js";import{g as ye,A as Ee,v as Ce,c as Se}from"../chunks/B1jZNMJx.js";import{a as Z,A as J}from"../chunks/BDh5lRBQ.js";function je({params:n}){return{id:n.id}}const Me=Object.freeze(Object.defineProperty({__proto__:null,load:je},Symbol.toStringTag,{value:"Module"}));function $(n,t,e){const r=n.slice();return r[18]=t[e][0],r[19]=t[e][1],r}function Te(n){let t,e,r,a,o=n[3]&&ee(n);function l(s){n[16](s)}let d={validationErrors:n[5],isSubmitting:n[2],isEdit:!0};return n[9]!==void 0&&(d.formData=n[9]),e=new Ee({props:d}),pe.push(()=>_e(e,"formData",l)),e.$on("submit",n[11]),e.$on("cancel",n[12]),{c(){o&&o.c(),t=B(),se(e.$$.fragment)},l(s){o&&o.l(s),t=U(s),ne(e.$$.fragment,s)},m(s,i){o&&o.m(s,i),I(s,t,i),le(e,s,i),a=!0},p(s,i){s[3]?o?o.p(s,i):(o=ee(s),o.c(),o.m(t.parentNode,t)):o&&(o.d(1),o=null);const c={};i&32&&(c.validationErrors=s[5]),i&4&&(c.isSubmitting=s[2]),!r&&i&512&&(r=!0,c.formData=s[9],he(()=>r=!1)),e.$set(c)},i(s){a||(W(e.$$.fragment,s),a=!0)},o(s){q(e.$$.fragment,s),a=!1},d(s){s&&_(t),o&&o.d(s),oe(e,s)}}}function Ae(n){let t,e,r="Error:",a,o,l,d=Object.keys(n[5]).length>0?" Corrige los siguientes campos:":"",s,i,c=Object.keys(n[5]).length>0,f=c&&te(n);return{c(){t=S("div"),e=S("span"),e.textContent=r,a=B(),o=S("span"),l=V(n[4]),s=V(d),i=B(),f&&f.c(),this.h()},l(v){t=C(v,"DIV",{class:!0,role:!0});var k=E(t);e=C(k,"SPAN",{class:!0,"data-svelte-h":!0}),Q(e)!=="svelte-1nq00is"&&(e.textContent=r),a=U(k),o=C(k,"SPAN",{class:!0});var b=E(o);l=x(b,n[4]),s=x(b,d),b.forEach(_),i=U(k),f&&f.l(k),k.forEach(_),this.h()},h(){m(e,"class","block sm:inline font-medium"),m(o,"class","block sm:inline"),m(t,"class","bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6"),m(t,"role","alert")},m(v,k){I(v,t,k),h(t,e),h(t,a),h(t,o),h(o,l),h(o,s),h(t,i),f&&f.m(t,null)},p(v,k){k&16&&G(l,v[4]),k&32&&d!==(d=Object.keys(v[5]).length>0?" Corrige los siguientes campos:":"")&&G(s,d),k&32&&(c=Object.keys(v[5]).length>0),c?f?f.p(v,k):(f=te(v),f.c(),f.m(t,null)):f&&(f.d(1),f=null)},i:M,o:M,d(v){v&&_(t),f&&f.d()}}}function De(n){let t,e='<p class="text-gray-500">Cargando datos del avalúo...</p>';return{c(){t=S("div"),t.innerHTML=e,this.h()},l(r){t=C(r,"DIV",{class:!0,"data-svelte-h":!0}),Q(t)!=="svelte-gztuae"&&(t.innerHTML=e),this.h()},h(){m(t,"class","text-center py-10")},m(r,a){I(r,t,a)},p:M,i:M,o:M,d(r){r&&_(t)}}}function ee(n){let t,e,r,a,o,l,d,s,i,c="Volver a Lista",f,v;function k(p,w){return p[7]&&p[8]===p[6]?Ie:Oe}let b=k(n),A=b(n);return{c(){t=S("div"),e=S("div"),r=S("span"),a=V(n[3]),o=B(),l=S("div"),d=S("button"),A.c(),s=B(),i=S("button"),i.textContent=c,this.h()},l(p){t=C(p,"DIV",{class:!0,role:!0});var w=E(t);e=C(w,"DIV",{class:!0});var D=E(e);r=C(D,"SPAN",{class:!0});var N=E(r);a=x(N,n[3]),N.forEach(_),o=U(D),l=C(D,"DIV",{class:!0});var z=E(l);d=C(z,"BUTTON",{class:!0});var y=E(d);A.l(y),y.forEach(_),s=U(z),i=C(z,"BUTTON",{class:!0,"data-svelte-h":!0}),Q(i)!=="svelte-17u9px8"&&(i.textContent=c),z.forEach(_),D.forEach(_),w.forEach(_),this.h()},h(){m(r,"class","block sm:inline"),d.disabled=n[7],m(d,"class","bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-3 py-1 rounded text-sm font-medium transition-colors flex items-center"),m(i,"class","bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm font-medium transition-colors"),m(l,"class","flex gap-2"),m(e,"class","flex justify-between items-center"),m(t,"class","bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-6"),m(t,"role","alert")},m(p,w){I(p,t,w),h(t,e),h(e,r),h(r,a),h(e,o),h(e,l),h(l,d),A.m(d,null),h(l,s),h(l,i),f||(v=[K(d,"click",n[14]),K(i,"click",n[15])],f=!0)},p(p,w){w&8&&G(a,p[3]),b!==(b=k(p))&&(A.d(1),A=b(p),A&&(A.c(),A.m(d,null))),w&128&&(d.disabled=p[7])},d(p){p&&_(t),A.d(),f=!1,be(v)}}}function Oe(n){let t,e,r;return{c(){t=F("svg"),e=F("path"),r=V(`
                  Imprimir Certificado`),this.h()},l(a){t=R(a,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var o=E(t);e=R(o,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),E(e).forEach(_),o.forEach(_),r=x(a,`
                  Imprimir Certificado`),this.h()},h(){m(e,"fill-rule","evenodd"),m(e,"d","M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z"),m(e,"clip-rule","evenodd"),m(t,"xmlns","http://www.w3.org/2000/svg"),m(t,"class","h-4 w-4 mr-1"),m(t,"viewBox","0 0 20 20"),m(t,"fill","currentColor")},m(a,o){I(a,t,o),h(t,e),I(a,r,o)},d(a){a&&(_(t),_(r))}}}function Ie(n){let t,e,r,a;return{c(){t=F("svg"),e=F("circle"),r=F("path"),a=V(`
                  Generando...`),this.h()},l(o){t=R(o,"svg",{class:!0,xmlns:!0,fill:!0,viewBox:!0});var l=E(t);e=R(l,"circle",{class:!0,cx:!0,cy:!0,r:!0,stroke:!0,"stroke-width":!0}),E(e).forEach(_),r=R(l,"path",{class:!0,fill:!0,d:!0}),E(r).forEach(_),l.forEach(_),a=x(o,`
                  Generando...`),this.h()},h(){m(e,"class","opacity-25"),m(e,"cx","12"),m(e,"cy","12"),m(e,"r","10"),m(e,"stroke","currentColor"),m(e,"stroke-width","4"),m(r,"class","opacity-75"),m(r,"fill","currentColor"),m(r,"d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),m(t,"class","animate-spin -ml-1 mr-2 h-4 w-4 text-white"),m(t,"xmlns","http://www.w3.org/2000/svg"),m(t,"fill","none"),m(t,"viewBox","0 0 24 24")},m(o,l){I(o,t,l),h(t,e),h(t,r),I(o,a,l)},d(o){o&&(_(t),_(a))}}}function te(n){let t,e=Y(Object.entries(n[5])),r=[];for(let a=0;a<e.length;a+=1)r[a]=ae($(n,e,a));return{c(){t=S("ul");for(let a=0;a<r.length;a+=1)r[a].c();this.h()},l(a){t=C(a,"UL",{class:!0});var o=E(t);for(let l=0;l<r.length;l+=1)r[l].l(o);o.forEach(_),this.h()},h(){m(t,"class","mt-2 list-disc list-inside")},m(a,o){I(a,t,o);for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(t,null)},p(a,o){if(o&32){e=Y(Object.entries(a[5]));let l;for(l=0;l<e.length;l+=1){const d=$(a,e,l);r[l]?r[l].p(d,o):(r[l]=ae(d),r[l].c(),r[l].m(t,null))}for(;l<r.length;l+=1)r[l].d(1);r.length=e.length}},d(a){a&&_(t),ge(r,a)}}}function re(n){let t,e,r=n[18]+"",a,o,l,d=n[19]+"",s;return{c(){t=S("li"),e=S("strong"),a=V(r),o=V(":"),l=B(),s=V(d)},l(i){t=C(i,"LI",{});var c=E(t);e=C(c,"STRONG",{});var f=E(e);a=x(f,r),o=x(f,":"),f.forEach(_),l=U(c),s=x(c,d),c.forEach(_)},m(i,c){I(i,t,c),h(t,e),h(e,a),h(e,o),h(t,l),h(t,s)},p(i,c){c&32&&r!==(r=i[18]+"")&&G(a,r),c&32&&d!==(d=i[19]+"")&&G(s,d)},d(i){i&&_(t)}}}function ae(n){let t,e=n[19]&&re(n);return{c(){e&&e.c(),t=X()},l(r){e&&e.l(r),t=X()},m(r,a){e&&e.m(r,a),I(r,t,a)},p(r,a){r[19]?e?e.p(r,a):(e=re(r),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},d(r){r&&_(t),e&&e.d(r)}}}function Ne(n){let t,e,r,a,o,l,d,s,i,c,f,v;e=new ke({props:{user:n[0]}});const k=[De,Ae,Te],b=[];function A(p,w){return p[1]?0:p[4]?1:2}return c=A(n),f=b[c]=k[c](n),{c(){t=S("div"),se(e.$$.fragment),r=B(),a=S("main"),o=S("div"),l=S("h1"),d=V("Editar Avalúo #"),s=V(n[10]),i=B(),f.c(),this.h()},l(p){t=C(p,"DIV",{class:!0});var w=E(t);ne(e.$$.fragment,w),r=U(w),a=C(w,"MAIN",{class:!0});var D=E(a);o=C(D,"DIV",{class:!0});var N=E(o);l=C(N,"H1",{class:!0});var z=E(l);d=x(z,"Editar Avalúo #"),s=x(z,n[10]),z.forEach(_),N.forEach(_),i=U(D),f.l(D),D.forEach(_),w.forEach(_),this.h()},h(){m(l,"class","text-2xl font-bold text-gray-800"),m(o,"class","flex justify-between items-center mb-6"),m(a,"class","max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"),m(t,"class","min-h-screen bg-gray-50")},m(p,w){I(p,t,w),le(e,t,null),h(t,r),h(t,a),h(a,o),h(o,l),h(l,d),h(l,s),h(a,i),b[c].m(a,null),v=!0},p(p,[w]){const D={};w&1&&(D.user=p[0]),e.$set(D);let N=c;c=A(p),c===N?b[c].p(p,w):(ve(),q(b[N],1,1,()=>{b[N]=null}),fe(),f=b[c],f?f.p(p,w):(f=b[c]=k[c](p),f.c()),W(f,1),f.m(a,null))},i(p){v||(W(e.$$.fragment,p),W(f),v=!0)},o(p){q(e.$$.fragment,p),q(f),v=!1},d(p){p&&_(t),oe(e),b[c].d()}}}function ze(n,t,e){let r;de(n,we,y=>e(17,r=y));let a=r.params.id,o=null,l=!0,d=!1,s="",i="",c={},f=null,v=!1,k=null,b=ye();me(async()=>{var O;const y=localStorage.getItem("userData");if(y&&e(0,o=JSON.parse(y)),!localStorage.getItem("jwtToken")){e(4,i="Sesión no válida. Redirigiendo al login..."),setTimeout(()=>H("/login"),2e3);return}try{e(1,l=!0);const u=await Z(J.AVALUOS.getById(a));e(9,b={appraisal_number:u.id||u.appraisal_number||a,appraisal_date:((O=u.appraisal_date)==null?void 0:O.split("T")[0])||"",vehicle_description:u.vehicle_description||"",brand:u.brand||"",model_year:u.model_year||0,color:u.color||"",mileage:u.mileage||0,fuel_type:u.fuel_type||"GAS",engine_size:u.engine_size||0,plate_number:u.plate_number||"",applicant:u.applicant||"",owner:u.owner||"",appraisal_value_usd:u.appraisal_value_usd||0,appraisal_value_trochez:u.appraisal_value_trochez||0,apprasail_value_bank:u.apprasail_value_bank||0,vin:u.vin||"",vin_card:u.vin_card||"",engine_number:u.engine_number||"",engine_number_card:u.engine_number_card||"",notes:u.notes||"",extras:u.extras||"",validity_days:u.validity_days||30,validity_kms:u.validity_kms||1e3,cert:u.cert||"",deductions:u.deductions||[]})}catch(u){e(4,i=`Error al cargar el avalúo: ${u.message||"Error desconocido"}`),u.status===401?(localStorage.removeItem("jwtToken"),setTimeout(()=>H("/login"),2e3),e(4,i="Sesión expirada. Por favor inicie sesión nuevamente.")):u.status===404&&(e(4,i=`No se encontró el avalúo con ID ${a}.`),setTimeout(()=>H("/avaluos"),3e3))}finally{e(1,l=!1)}});async function A(){var y;e(2,d=!0),e(4,i=""),e(3,s=""),e(5,c={});try{if(e(5,c=Ce(b,!0)),Object.keys(c).length>0&&(e(5,c=Object.fromEntries(Object.entries(c).filter(([u,j])=>j))),Object.keys(c).length>0))throw new Error("Por favor corrija los errores de validación.");if(!localStorage.getItem("jwtToken"))throw new Error("No se encontró token de autenticación. Por favor inicie sesión nuevamente.");const O=Se(b);try{await Z(J.AVALUOS.update(a),{method:"PUT",body:JSON.stringify(O)}),e(6,f=a),e(3,s="Avalúo actualizado correctamente."),e(2,d=!1)}catch(u){u.status===401?(localStorage.removeItem("jwtToken"),setTimeout(()=>H("/login"),2e3),e(4,i="Sesión expirada. Por favor inicie sesión nuevamente.")):u.status===422&&((y=u.data)!=null&&y.detail)?(e(4,i="Error de validación del servidor. Por favor revise los campos."),e(5,c={}),u.data.detail.forEach(j=>{const T=j.loc[j.loc.length-1];T&&e(5,c[T]=j.msg,c)})):e(4,i=u.message||"Error al comunicarse con el servidor.")}}catch(P){i||e(4,i=P.message||"Ha ocurrido un error al actualizar el avalúo.")}finally{e(2,d=!1)}}function p(){H("/avaluos")}async function w(y){try{const P=localStorage.getItem("jwtToken");if(!P){alert("No se encontró token de autenticación. Por favor inicie sesión nuevamente."),setTimeout(()=>H("/login"),1e3);return}e(7,v=!0),e(8,k=y);const O=await fetch(J.CERTIFICADOS.get(y),{method:"GET",headers:{Authorization:`Bearer ${P}`}});if(!O.ok)throw new Error(`Error al obtener el certificado: ${O.status} ${O.statusText}`);const u=O.headers.get("content-type");if(u&&u.includes("application/pdf")){const j=await O.blob(),T=window.URL.createObjectURL(j);try{const L=window.open(T,"_blank");if(!L||L.closed||typeof L.closed>"u"){const g=document.createElement("a");g.href=T,g.target="_blank",g.download=`certificado_${y}.pdf`,document.body.appendChild(g),g.click(),document.body.removeChild(g),setTimeout(()=>{alert("El certificado se está descargando. Si no se abrió automáticamente, revisa tu carpeta de descargas.")},100)}}catch{const g=document.createElement("a");g.href=T,g.download=`certificado_${y}.pdf`,document.body.appendChild(g),g.click(),document.body.removeChild(g),alert("El certificado se está descargando. Revisa tu carpeta de descargas.")}}else if(u&&u.includes("application/json")){const j=await O.json();if(j.url)try{const T=window.open(j.url,"_blank");(!T||T.closed||typeof T.closed>"u")&&(window.location.href=j.url)}catch{window.location.href=j.url}else throw new Error(j.message||"Error al generar el certificado")}else{const j=await O.blob(),T=window.URL.createObjectURL(j);try{const L=window.open(T,"_blank");if(!L||L.closed||typeof L.closed>"u"){const g=document.createElement("a");g.href=T,g.target="_blank",g.download=`certificado_${y}.pdf`,document.body.appendChild(g),g.click(),document.body.removeChild(g)}}catch{const g=document.createElement("a");g.href=T,g.download=`certificado_${y}.pdf`,document.body.appendChild(g),g.click(),document.body.removeChild(g)}}}catch(P){alert(`Error al obtener el certificado: ${P.message}`)}finally{e(7,v=!1),e(8,k=null)}}const D=()=>w(f),N=()=>H("/avaluos");function z(y){b=y,e(9,b)}return[o,l,d,s,i,c,f,v,k,b,a,A,p,w,D,N,z]}class Re extends ie{constructor(t){super(),ce(this,t,ze,Ne,ue,{})}}export{Re as component,Me as universal};
