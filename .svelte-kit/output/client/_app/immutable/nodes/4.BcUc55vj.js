import{S as oe,i as ne,s as ie,d as p,p as re,q as R,r as G,Q as ce,b as T,v as ae,c as h,w as m,e as y,f as w,x as le,h as V,g as N,j as E,z as se,k as L,t as z,l as ue,A as fe,n as B,y as J,a as F,m as de,o as me,u as _e,D as pe,B as he,C as Q,G as K,E as H,F as M,R as ge}from"../chunks/CnbjcvQe.js";import{N as ve,e as W}from"../chunks/BKELNo4D.js";import"../chunks/IHki7fMi.js";import{g as P}from"../chunks/Brl5YFAa.js";import{p as be}from"../chunks/sBQDK4gc.js";import{g as ke,A as we,v as ye,c as Ee}from"../chunks/CtiylSPp.js";import{a as X,A as q}from"../chunks/BDh5lRBQ.js";function Se({params:o}){return{id:o.id}}const Be=Object.freeze(Object.defineProperty({__proto__:null,load:Se},Symbol.toStringTag,{value:"Module"}));function Y(o,t,e){const r=o.slice();return r[18]=t[e][0],r[19]=t[e][1],r}function je(o){let t,e,r,a,l=o[3]&&Z(o);function s(n){o[16](n)}let d={validationErrors:o[5],isSubmitting:o[2],isEdit:!0};return o[9]!==void 0&&(d.formData=o[9]),e=new we({props:d}),de.push(()=>me(e,"formData",s)),e.$on("submit",o[11]),e.$on("cancel",o[12]),{c(){l&&l.c(),t=L(),se(e.$$.fragment)},l(n){l&&l.l(n),t=V(n),le(e.$$.fragment,n)},m(n,i){l&&l.m(n,i),T(n,t,i),ae(e,n,i),a=!0},p(n,i){n[3]?l?l.p(n,i):(l=Z(n),l.c(),l.m(t.parentNode,t)):l&&(l.d(1),l=null);const c={};i&32&&(c.validationErrors=n[5]),i&4&&(c.isSubmitting=n[2]),!r&&i&512&&(r=!0,c.formData=n[9],_e(()=>r=!1)),e.$set(c)},i(n){a||(G(e.$$.fragment,n),a=!0)},o(n){R(e.$$.fragment,n),a=!1},d(n){n&&p(t),l&&l.d(n),re(e,n)}}}function Ae(o){let t,e,r="Error:",a,l,s,d=Object.keys(o[5]).length>0?" Corrige los siguientes campos:":"",n,i,c=Object.keys(o[5]).length>0,f=c&&$(o);return{c(){t=E("div"),e=E("span"),e.textContent=r,a=L(),l=E("span"),s=z(o[4]),n=z(d),i=L(),f&&f.c(),this.h()},l(v){t=y(v,"DIV",{class:!0,role:!0});var b=w(t);e=y(b,"SPAN",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-1nq00is"&&(e.textContent=r),a=V(b),l=y(b,"SPAN",{class:!0});var g=w(l);s=N(g,o[4]),n=N(g,d),g.forEach(p),i=V(b),f&&f.l(b),b.forEach(p),this.h()},h(){m(e,"class","block sm:inline font-medium"),m(l,"class","block sm:inline"),m(t,"class","bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-6"),m(t,"role","alert")},m(v,b){T(v,t,b),h(t,e),h(t,a),h(t,l),h(l,s),h(l,n),h(t,i),f&&f.m(t,null)},p(v,b){b&16&&F(s,v[4]),b&32&&d!==(d=Object.keys(v[5]).length>0?" Corrige los siguientes campos:":"")&&F(n,d),b&32&&(c=Object.keys(v[5]).length>0),c?f?f.p(v,b):(f=$(v),f.c(),f.m(t,null)):f&&(f.d(1),f=null)},i:B,o:B,d(v){v&&p(t),f&&f.d()}}}function Ce(o){let t,e='<p class="text-gray-500">Cargando datos del avalúo...</p>';return{c(){t=E("div"),t.innerHTML=e,this.h()},l(r){t=y(r,"DIV",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-gztuae"&&(t.innerHTML=e),this.h()},h(){m(t,"class","text-center py-10")},m(r,a){T(r,t,a)},p:B,i:B,o:B,d(r){r&&p(t)}}}function Z(o){let t,e,r,a,l,s,d,n,i,c="Volver a Lista",f,v;function b(_,k){return _[7]&&_[8]===_[6]?Te:De}let g=b(o),j=g(o);return{c(){t=E("div"),e=E("div"),r=E("span"),a=z(o[3]),l=L(),s=E("div"),d=E("button"),j.c(),n=L(),i=E("button"),i.textContent=c,this.h()},l(_){t=y(_,"DIV",{class:!0,role:!0});var k=w(t);e=y(k,"DIV",{class:!0});var A=w(e);r=y(A,"SPAN",{class:!0});var I=w(r);a=N(I,o[3]),I.forEach(p),l=V(A),s=y(A,"DIV",{class:!0});var O=w(s);d=y(O,"BUTTON",{class:!0});var S=w(d);j.l(S),S.forEach(p),n=V(O),i=y(O,"BUTTON",{class:!0,"data-svelte-h":!0}),J(i)!=="svelte-17u9px8"&&(i.textContent=c),O.forEach(p),A.forEach(p),k.forEach(p),this.h()},h(){m(r,"class","block sm:inline"),d.disabled=o[7],m(d,"class","bg-green-600 hover:bg-green-700 disabled:bg-gray-400 text-white px-3 py-1 rounded text-sm font-medium transition-colors flex items-center"),m(i,"class","bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm font-medium transition-colors"),m(s,"class","flex gap-2"),m(e,"class","flex justify-between items-center"),m(t,"class","bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-6"),m(t,"role","alert")},m(_,k){T(_,t,k),h(t,e),h(e,r),h(r,a),h(e,l),h(e,s),h(s,d),j.m(d,null),h(s,n),h(s,i),f||(v=[Q(d,"click",o[14]),Q(i,"click",o[15])],f=!0)},p(_,k){k&8&&F(a,_[3]),g!==(g=b(_))&&(j.d(1),j=g(_),j&&(j.c(),j.m(d,null))),k&128&&(d.disabled=_[7])},d(_){_&&p(t),j.d(),f=!1,he(v)}}}function De(o){let t,e,r;return{c(){t=M("svg"),e=M("path"),r=z(`
                  Imprimir Certificado`),this.h()},l(a){t=H(a,"svg",{xmlns:!0,class:!0,viewBox:!0,fill:!0});var l=w(t);e=H(l,"path",{"fill-rule":!0,d:!0,"clip-rule":!0}),w(e).forEach(p),l.forEach(p),r=N(a,`
                  Imprimir Certificado`),this.h()},h(){m(e,"fill-rule","evenodd"),m(e,"d","M5 4v3H4a2 2 0 00-2 2v3a2 2 0 002 2h1v2a2 2 0 002 2h6a2 2 0 002-2v-2h1a2 2 0 002-2V9a2 2 0 00-2-2h-1V4a2 2 0 00-2-2H7a2 2 0 00-2 2zm8 0H7v3h6V4zm0 8H7v4h6v-4z"),m(e,"clip-rule","evenodd"),m(t,"xmlns","http://www.w3.org/2000/svg"),m(t,"class","h-4 w-4 mr-1"),m(t,"viewBox","0 0 20 20"),m(t,"fill","currentColor")},m(a,l){T(a,t,l),h(t,e),T(a,r,l)},d(a){a&&(p(t),p(r))}}}function Te(o){let t,e,r,a;return{c(){t=M("svg"),e=M("circle"),r=M("path"),a=z(`
                  Generando...`),this.h()},l(l){t=H(l,"svg",{class:!0,xmlns:!0,fill:!0,viewBox:!0});var s=w(t);e=H(s,"circle",{class:!0,cx:!0,cy:!0,r:!0,stroke:!0,"stroke-width":!0}),w(e).forEach(p),r=H(s,"path",{class:!0,fill:!0,d:!0}),w(r).forEach(p),s.forEach(p),a=N(l,`
                  Generando...`),this.h()},h(){m(e,"class","opacity-25"),m(e,"cx","12"),m(e,"cy","12"),m(e,"r","10"),m(e,"stroke","currentColor"),m(e,"stroke-width","4"),m(r,"class","opacity-75"),m(r,"fill","currentColor"),m(r,"d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),m(t,"class","animate-spin -ml-1 mr-2 h-4 w-4 text-white"),m(t,"xmlns","http://www.w3.org/2000/svg"),m(t,"fill","none"),m(t,"viewBox","0 0 24 24")},m(l,s){T(l,t,s),h(t,e),h(t,r),T(l,a,s)},d(l){l&&(p(t),p(a))}}}function $(o){let t,e=W(Object.entries(o[5])),r=[];for(let a=0;a<e.length;a+=1)r[a]=te(Y(o,e,a));return{c(){t=E("ul");for(let a=0;a<r.length;a+=1)r[a].c();this.h()},l(a){t=y(a,"UL",{class:!0});var l=w(t);for(let s=0;s<r.length;s+=1)r[s].l(l);l.forEach(p),this.h()},h(){m(t,"class","mt-2 list-disc list-inside")},m(a,l){T(a,t,l);for(let s=0;s<r.length;s+=1)r[s]&&r[s].m(t,null)},p(a,l){if(l&32){e=W(Object.entries(a[5]));let s;for(s=0;s<e.length;s+=1){const d=Y(a,e,s);r[s]?r[s].p(d,l):(r[s]=te(d),r[s].c(),r[s].m(t,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=e.length}},d(a){a&&p(t),pe(r,a)}}}function ee(o){let t,e,r=o[18]+"",a,l,s,d=o[19]+"",n;return{c(){t=E("li"),e=E("strong"),a=z(r),l=z(":"),s=L(),n=z(d)},l(i){t=y(i,"LI",{});var c=w(t);e=y(c,"STRONG",{});var f=w(e);a=N(f,r),l=N(f,":"),f.forEach(p),s=V(c),n=N(c,d),c.forEach(p)},m(i,c){T(i,t,c),h(t,e),h(e,a),h(e,l),h(t,s),h(t,n)},p(i,c){c&32&&r!==(r=i[18]+"")&&F(a,r),c&32&&d!==(d=i[19]+"")&&F(n,d)},d(i){i&&p(t)}}}function te(o){let t,e=o[19]&&ee(o);return{c(){e&&e.c(),t=K()},l(r){e&&e.l(r),t=K()},m(r,a){e&&e.m(r,a),T(r,t,a)},p(r,a){r[19]?e?e.p(r,a):(e=ee(r),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},d(r){r&&p(t),e&&e.d(r)}}}function Ie(o){let t,e,r,a,l,s,d,n,i,c,f,v;e=new ve({props:{user:o[0]}});const b=[Ce,Ae,je],g=[];function j(_,k){return _[1]?0:_[4]?1:2}return c=j(o),f=g[c]=b[c](o),{c(){t=E("div"),se(e.$$.fragment),r=L(),a=E("main"),l=E("div"),s=E("h1"),d=z("Editar Avalúo #"),n=z(o[10]),i=L(),f.c(),this.h()},l(_){t=y(_,"DIV",{class:!0});var k=w(t);le(e.$$.fragment,k),r=V(k),a=y(k,"MAIN",{class:!0});var A=w(a);l=y(A,"DIV",{class:!0});var I=w(l);s=y(I,"H1",{class:!0});var O=w(s);d=N(O,"Editar Avalúo #"),n=N(O,o[10]),O.forEach(p),I.forEach(p),i=V(A),f.l(A),A.forEach(p),k.forEach(p),this.h()},h(){m(s,"class","text-2xl font-bold text-gray-800"),m(l,"class","flex justify-between items-center mb-6"),m(a,"class","max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"),m(t,"class","min-h-screen bg-gray-50")},m(_,k){T(_,t,k),ae(e,t,null),h(t,r),h(t,a),h(a,l),h(l,s),h(s,d),h(s,n),h(a,i),g[c].m(a,null),v=!0},p(_,[k]){const A={};k&1&&(A.user=_[0]),e.$set(A);let I=c;c=j(_),c===I?g[c].p(_,k):(ge(),R(g[I],1,1,()=>{g[I]=null}),ce(),f=g[c],f?f.p(_,k):(f=g[c]=b[c](_),f.c()),G(f,1),f.m(a,null))},i(_){v||(G(e.$$.fragment,_),G(f),v=!0)},o(_){R(e.$$.fragment,_),R(f),v=!1},d(_){_&&p(t),re(e),g[c].d()}}}function Oe(o,t,e){let r;ue(o,be,S=>e(17,r=S));let a=r.params.id,l=null,s=!0,d=!1,n="",i="",c={},f=null,v=!1,b=null,g=ke();fe(async()=>{var D;const S=localStorage.getItem("userData");if(S&&e(0,l=JSON.parse(S)),!localStorage.getItem("jwtToken")){e(4,i="Sesión no válida. Redirigiendo al login..."),setTimeout(()=>P("/login"),2e3);return}try{e(1,s=!0);const u=await X(q.AVALUOS.getById(a));e(9,g={appraisal_number:u.id||u.appraisal_number||a,appraisal_date:((D=u.appraisal_date)==null?void 0:D.split("T")[0])||"",vehicle_description:u.vehicle_description||"",brand:u.brand||"",model_year:u.model_year||0,color:u.color||"",mileage:u.mileage||0,fuel_type:u.fuel_type||"GAS",engine_size:u.engine_size||0,plate_number:u.plate_number||"",applicant:u.applicant||"",owner:u.owner||"",appraisal_value_usd:u.appraisal_value_usd||0,appraisal_value_trochez:u.appraisal_value_trochez||0,apprasail_value_bank:u.apprasail_value_bank||0,vin:u.vin||"",vin_card:u.vin_card||"",engine_number:u.engine_number||"",engine_number_card:u.engine_number_card||"",notes:u.notes||"",extras:u.extras||"",validity_days:u.validity_days||30,validity_kms:u.validity_kms||1e3,cert:u.cert||"",deductions:u.deductions||[]})}catch(u){e(4,i=`Error al cargar el avalúo: ${u.message||"Error desconocido"}`),u.status===401?(localStorage.removeItem("jwtToken"),setTimeout(()=>P("/login"),2e3),e(4,i="Sesión expirada. Por favor inicie sesión nuevamente.")):u.status===404&&(e(4,i=`No se encontró el avalúo con ID ${a}.`),setTimeout(()=>P("/avaluos"),3e3))}finally{e(1,s=!1)}});async function j(){var S;e(2,d=!0),e(4,i=""),e(3,n=""),e(5,c={});try{if(e(5,c=ye(g,!0)),Object.keys(c).length>0&&(e(5,c=Object.fromEntries(Object.entries(c).filter(([u,C])=>C))),Object.keys(c).length>0))throw new Error("Por favor corrija los errores de validación.");if(!localStorage.getItem("jwtToken"))throw new Error("No se encontró token de autenticación. Por favor inicie sesión nuevamente.");const D=Ee(g);try{await X(q.AVALUOS.update(a),{method:"PUT",body:JSON.stringify(D)}),e(6,f=a),e(3,n="Avalúo actualizado correctamente."),e(2,d=!1)}catch(u){u.status===401?(localStorage.removeItem("jwtToken"),setTimeout(()=>P("/login"),2e3),e(4,i="Sesión expirada. Por favor inicie sesión nuevamente.")):u.status===422&&((S=u.data)!=null&&S.detail)?(e(4,i="Error de validación del servidor. Por favor revise los campos."),e(5,c={}),u.data.detail.forEach(C=>{const U=C.loc[C.loc.length-1];U&&e(5,c[U]=C.msg,c)})):e(4,i=u.message||"Error al comunicarse con el servidor.")}}catch(x){i||e(4,i=x.message||"Ha ocurrido un error al actualizar el avalúo.")}finally{e(2,d=!1)}}function _(){P("/avaluos")}async function k(S){try{const x=localStorage.getItem("jwtToken");if(!x){alert("No se encontró token de autenticación. Por favor inicie sesión nuevamente."),setTimeout(()=>P("/login"),1e3);return}e(7,v=!0),e(8,b=S);const D=await fetch(q.CERTIFICADOS.get(S),{method:"GET",headers:{Authorization:`Bearer ${x}`}});if(!D.ok)throw new Error(`Error al obtener el certificado: ${D.status} ${D.statusText}`);const u=D.headers.get("content-type");if(u&&u.includes("application/pdf")){const C=await D.blob(),U=window.URL.createObjectURL(C);window.open(U,"_blank")}else if(u&&u.includes("application/json")){const C=await D.json();if(C.url)window.open(C.url,"_blank");else throw new Error(C.message||"Error al generar el certificado")}else{const C=await D.blob(),U=window.URL.createObjectURL(C);window.open(U,"_blank")}}catch(x){alert(`Error al obtener el certificado: ${x.message}`)}finally{e(7,v=!1),e(8,b=null)}}const A=()=>k(f),I=()=>P("/avaluos");function O(S){g=S,e(9,g)}return[l,s,d,n,i,c,f,v,b,g,a,j,_,k,A,I,O]}class He extends oe{constructor(t){super(),ne(this,t,Oe,Ie,ie,{})}}export{He as component,Be as universal};
